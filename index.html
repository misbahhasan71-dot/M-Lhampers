<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M&L Hampers - Curated Gift Hampers for Every Occasion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        .font-playfair {
            font-family: 'Playfair Display', serif;
        }
        .hero-bg {
            background-image: linear-gradient(to top, rgba(0,0,0,0.6), rgba(0,0,0,0.1)), url('https://images.unsplash.com/photo-1604164372215-2a2245224716?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            transition: background-image 0.5s ease-in-out;
        }
        .card-hover-effect {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .card-hover-effect:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .hero-text-shadow {
            text-shadow: 2px 2px 8px rgba(217, 119, 6, 0.5);
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #a87c5b;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-stone-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-3xl font-playfair font-bold text-amber-800">M&L Hampers</a>
            <div class="hidden md:flex space-x-8">
                <a href="#home" class="text-gray-600 hover:text-amber-800 transition duration-300">Home</a>
                <a href="#hampers" class="text-gray-600 hover:text-amber-800 transition duration-300">Hampers</a>
                <a href="#contact" class="text-gray-600 hover:text-amber-800 transition duration-300">Contact</a>
                <a href="#about" class="text-gray-600 hover:text-amber-800 transition duration-300">About Us</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-gray-600 hover:text-amber-800 focus:outline-none">
                <i class="fas fa-bars fa-lg"></i>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
            <a href="#home" class="block py-2 text-gray-600 hover:text-amber-800">Home</a>
            <a href="#hampers" class="block py-2 text-gray-600 hover:text-amber-800">Hampers</a>
            <a href="#contact" class="block py-2 text-gray-600 hover:text-amber-800">Contact</a>
            <a href="#about" class="block py-2 text-gray-600 hover:text-amber-800">About Us</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero-bg text-white h-[80vh] flex items-center">
        <div class="container mx-auto px-6 text-center">
            <h1 id="hero-title" class="text-4xl md:text-7xl font-playfair font-bold mb-4 leading-tight hero-text-shadow">Gifting, Reimagined.</h1>
            <p id="hero-subtitle" class="text-lg md:text-xl max-w-3xl mx-auto mb-8">Discover beautifully curated hampers that tell a story and create lasting memories.</p>
            <a id="hero-button" href="#hampers" class="bg-amber-700 hover:bg-amber-800 text-white font-bold py-3 px-8 rounded-full transition duration-300 text-lg">Explore Our Collections</a>
        </div>
    </section>

    <!-- Hampers Showcase -->
    <section id="hampers" class="py-20 bg-stone-50">
        <div class="container mx-auto px-6">
            <div id="collections-container">
                <h2 class="text-4xl font-playfair text-center font-bold text-amber-800 mb-12">Our Collections</h2>
                <div id="collection-grid-loader" class="flex justify-center items-center h-64">
                    <div class="loader"></div>
                </div>
                <div id="collection-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10 hidden"></div>
            </div>
            <div id="products-container" class="hidden">
                <div class="flex justify-between items-center mb-12 flex-wrap gap-4">
                     <button id="back-to-collections" class="text-amber-800 hover:text-amber-600 font-semibold order-1">
                        <i class="fas fa-arrow-left mr-2"></i> Back to Collections
                    </button>
                    <h2 id="product-collection-title" class="text-4xl font-playfair text-center font-bold text-amber-800 order-2 flex-grow"></h2>
                    <div class="w-24 order-3"></div>
                </div>
                <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10"></div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-playfair text-center font-bold text-amber-800 mb-12">Get In Touch</h2>
            <div class="flex flex-col md:flex-row gap-12">
                <div class="md:w-1/2">
                    <h3 class="text-2xl font-playfair font-bold mb-4">Contact Details</h3>
                    <p class="text-lg mb-6">We'd love to hear from you! For custom orders, inquiries, or collaborations, please reach out.</p>
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <i class="fas fa-phone text-amber-700 w-6"></i>
                            <a href="tel:8948581236" class="ml-3 text-lg hover:text-amber-800">8948581236</a>, <a href="tel:9696066486" class="ml-1 text-lg hover:text-amber-800">9696066486</a>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-envelope text-amber-700 w-6"></i>
                            <a href="mailto:misbahhasan71@yahoo.com" class="ml-3 text-lg hover:text-amber-800">misbahhasan71@yahoo.com</a>
                        </div>
                         <div class="flex items-center">
                            <i class="fas fa-map-marker-alt text-amber-700 w-6"></i>
                            <p class="ml-3 text-lg">Fatehpur, Uttar Pradesh, India</p>
                        </div>
                    </div>
                </div>
                <div class="md:w-1/2">
                     <h3 class="text-2xl font-playfair font-bold mb-4">Send us a Message</h3>
                    <form id="contactForm">
                        <div class="mb-4">
                            <input type="text" placeholder="Your Name" class="w-full px-4 py-3 rounded-lg bg-stone-100 focus:outline-none focus:ring-2 focus:ring-amber-700" required>
                        </div>
                        <div class="mb-4">
                            <input type="email" placeholder="Your Email" class="w-full px-4 py-3 rounded-lg bg-stone-100 focus:outline-none focus:ring-2 focus:ring-amber-700" required>
                        </div>
                        <div class="mb-4">
                            <textarea placeholder="Your Message" rows="5" class="w-full px-4 py-3 rounded-lg bg-stone-100 focus:outline-none focus:ring-2 focus:ring-amber-700" required></textarea>
                        </div>
                        <button type="submit" class="w-full bg-amber-700 hover:bg-amber-800 text-white font-bold py-3 px-8 rounded-full transition duration-300">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- About Us Section -->
    <section id="about" class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-playfair text-center font-bold text-amber-800 mb-12">Our Story</h2>
            <div class="flex flex-col md:flex-row items-center gap-12">
                <div class="md:w-1/2 text-center md:text-left">
                    <p class="text-lg mb-4">M&L Hampers was born from a shared passion for thoughtful gifting between our founders, <span class="font-bold">Misbah Hasan</span> and <span class="font-bold">Lubna Fatima</span>. We believe a gift is more than just an item; it's an expression of love, appreciation, and celebration.</p>
                    <p class="text-lg">Our mission is to make every occasion special with meticulously curated hampers that delight the senses and warm the heart. From sourcing the finest products to elegant packaging, every detail is handled with care and a personal touch.</p>
                </div>
                <div class="md:w-1/2 grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <img src="https://images.unsplash.com/photo-1568602471122-7832951cc4c5?q=80&w=2070&auto=format&fit=crop" alt="Founder Misbah Hasan" class="w-48 h-48 mx-auto rounded-full object-cover shadow-lg">
                        <h3 class="mt-4 text-xl font-bold">Misbah Hasan</h3>
                        <p class="text-gray-500">Founder</p>
                    </div>
                    <div class="text-center">
                        <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?q=80&w=1888&auto=format&fit=crop" alt="Co-Founder Lubna Fatima" class="w-48 h-48 mx-auto rounded-full object-cover shadow-lg">
                        <h3 class="mt-4 text-xl font-bold">Lubna Fatima</h3>
                        <p class="text-gray-500">Co-Founder</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-10">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2024 M&L Hampers. All Rights Reserved.</p>
            <p class="mt-2">Designed with <button id="secretAdminLogin" class="bg-transparent border-none p-0"><i class="fas fa-heart text-red-500 hover:text-red-400 transition-colors"></i></button></p>
        </div>
    </footer>

    <!-- Admin Login Modal -->
    <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-4 text-center">Admin Login</h2>
            <form id="adminLoginForm">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="username" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required>
                </div>
                 <div id="login-error" class="text-red-500 text-sm mb-4 hidden"></div>
                <div class="flex items-center justify-between">
                    <button type="submit" class="w-full bg-amber-700 hover:bg-amber-800 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline">Sign In</button>
                    <button type="button" id="closeModal" class="ml-4 text-gray-500 hover:text-gray-800">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div id="adminPanel" class="fixed inset-0 bg-gray-100 z-50 p-4 md:p-8 hidden overflow-y-auto">
        <div class="max-w-6xl mx-auto bg-white rounded-lg shadow-xl p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-amber-800">Admin Dashboard</h2>
                <div class="flex gap-4">
                    <button id="viewMessagesBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md">View Messages</button>
                    <button id="logoutButton" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-md">Logout</button>
                </div>
            </div>

            <!-- Manage Hero Section -->
             <div class="bg-stone-50 p-6 rounded-lg mt-6 border-t-4 border-purple-700">
                <h3 class="font-bold text-2xl mb-4 text-gray-800">Manage Hero Content</h3>
                <div id="hero-success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4">
                    <strong class="font-bold">Success!</strong>
                    <span class="block sm:inline">Hero content updated.</span>
                </div>
                <form id="manageHeroForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
                        <div>
                            <label for="heroTitleInput" class="block text-sm font-medium text-gray-700">Main Title</label>
                            <input type="text" id="heroTitleInput" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            
                            <label for="heroSubtitleInput" class="block text-sm font-medium text-gray-700 mt-4">Subtitle</label>
                            <textarea id="heroSubtitleInput" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                            
                            <label for="heroButtonInput" class="block text-sm font-medium text-gray-700 mt-4">Button Text</label>
                            <input type="text" id="heroButtonInput" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Background Image</label>
                            <img id="heroImagePreview" src="" class="mt-1 w-full h-32 object-cover rounded-md border bg-gray-200">
                            <label for="heroImageInput" class="block text-sm font-medium text-gray-700 mt-2">Upload New Image</label>
                            <input type="file" id="heroImageInput" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-amber-100 file:text-amber-800 hover:file:bg-amber-200">
                        </div>
                    </div>
                    <button type="submit" class="mt-4 w-full md:w-auto bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-md">Save Hero Changes</button>
                </form>
            </div>


            <!-- Create Collection Section -->
            <div class="bg-stone-50 p-6 rounded-lg mt-8 border-t-4 border-green-700">
                <h3 class="font-bold text-2xl mb-4 text-gray-800">Create New Collection</h3>
                <div id="collection-success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <strong class="font-bold">Success!</strong>
                    <span class="block sm:inline">New collection created.</span>
                </div>
                <div id="collection-error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <strong class="font-bold">Error!</strong>
                    <span class="block sm:inline" id="collection-error-text"></span>
                </div>
                <form id="createCollectionForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                        <div>
                            <label for="newCollectionName" class="block text-sm font-medium text-gray-700">Collection Name</label>
                            <input type="text" id="newCollectionName" placeholder="e.g., Corporate Gifts" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required>
                        </div>
                        <div>
                            <label for="newCollectionBannerImage" class="block text-sm font-medium text-gray-700">Banner Image</label>
                            <input type="file" id="newCollectionBannerImage" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-amber-100 file:text-amber-800 hover:file:bg-amber-200" required>
                        </div>
                    </div>
                    <button type="submit" class="mt-4 w-full md:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-md">Create Collection</button>
                </form>
            </div>
            
            <!-- Add Product Section -->
            <div class="bg-stone-50 p-6 rounded-lg mt-8 border-t-4 border-amber-700">
                <h3 class="font-bold text-2xl mb-4 text-gray-800">Add Product</h3>
                 <div id="product-success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <strong class="font-bold">Success!</strong>
                    <span class="block sm:inline">New product added to the database.</span>
                </div>
                <form id="addProductForm">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div>
                             <label for="productCollection" class="block text-sm font-medium text-gray-700">Collection</label>
                            <select id="productCollection" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required></select>
                        </div>
                        <div>
                            <label for="productName" class="block text-sm font-medium text-gray-700">Product Name</label>
                            <input type="text" id="productName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required>
                        </div>
                         <div>
                            <label for="productPrice" class="block text-sm font-medium text-gray-700">Price (e.g., ₹1,499)</label>
                            <input type="text" id="productPrice" placeholder="e.g., ₹1,499" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required>
                        </div>
                        <div>
                            <label for="productImage" class="block text-sm font-medium text-gray-700">Product Image</label>
                            <input type="file" id="productImage" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-amber-100 file:text-amber-800 hover:file:bg-amber-200" required>
                        </div>
                    </div>
                    <button type="submit" class="mt-4 w-full md:w-auto bg-amber-700 hover:bg-amber-800 text-white font-bold py-2 px-6 rounded-md">Add Product</button>
                </form>
            </div>

            <!-- Manage Products Section -->
            <div class="bg-stone-50 p-6 rounded-lg mt-8 border-t-4 border-blue-700">
                <h3 class="font-bold text-2xl mb-4 text-gray-800">Manage Products</h3>
                 <div id="edit-product-success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <strong class="font-bold">Success!</strong>
                    <span class="block sm:inline">Product has been updated.</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end mb-4">
                    <div>
                        <label for="manageCollectionSelect" class="block text-sm font-medium text-gray-700">Collection</label>
                        <select id="manageCollectionSelect" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500"></select>
                    </div>
                    <div>
                        <label for="searchProductToManage" class="block text-sm font-medium text-gray-700">Search Product</label>
                        <input type="text" id="searchProductToManage" placeholder="Type to search..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500">
                    </div>
                </div>
                <div id="productListContainer" class="mt-4 max-h-96 overflow-y-auto">
                    <!-- Products to manage will be listed here -->
                </div>
            </div>
            
             <!-- Banner Management Section -->
            <div class="bg-stone-50 p-6 rounded-lg mt-8 border-t-4 border-amber-700">
                <h3 class="font-bold text-2xl mb-4 text-gray-800">Manage Collection Banners</h3>
                 <div id="banner-success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <strong class="font-bold">Success!</strong>
                    <span class="block sm:inline">Banner image updated in the database.</span>
                </div>
                <form id="updateBannerForm">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                        <div class="md:col-span-1">
                             <label for="bannerCollectionSelect" class="block text-sm font-medium text-gray-700">Choose Collection</label>
                            <select id="bannerCollectionSelect" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required></select>
                        </div>
                        <div class="md:col-span-2">
                            <label for="collectionBannerImage" class="block text-sm font-medium text-gray-700">New Banner Image</label>
                            <input type="file" id="collectionBannerImage" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-amber-100 file:text-amber-800 hover:file:bg-amber-200" required>
                        </div>
                    </div>
                    <button type="submit" class="mt-4 w-full md:w-auto bg-amber-700 hover:bg-amber-800 text-white font-bold py-2 px-6 rounded-md">Update Banner</button>
                </form>
            </div>

            <!-- Remove Product Section -->
            <div class="bg-stone-50 p-6 rounded-lg mt-8 border-t-4 border-red-700">
                <h3 class="font-bold text-2xl mb-4 text-gray-800">Remove Product</h3>
                <div id="remove-product-success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <strong class="font-bold">Success!</strong>
                    <span class="block sm:inline">Product has been removed from the database.</span>
                </div>
                <form id="removeProductForm">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-start">
                        <div>
                            <label for="removeProductCollectionSelect" class="block text-sm font-medium text-gray-700">Collection</label>
                            <select id="removeProductCollectionSelect" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required></select>
                        </div>
                        <div class="md:col-span-2">
                             <div>
                                <label for="searchProductToRemove" class="block text-sm font-medium text-gray-700">Search Product Name</label>
                                <input type="text" id="searchProductToRemove" placeholder="Type to search..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500">
                            </div>
                            <div class="mt-4">
                                <label for="productToRemoveSelect" class="block text-sm font-medium text-gray-700">Product to Remove</label>
                                <select id="productToRemoveSelect" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required></select>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="mt-4 w-full md:w-auto bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-md">Remove Product</button>
                </form>
            </div>
            
            <!-- Reset Data Section -->
            <div class="bg-stone-50 p-6 rounded-lg mt-8 border-t-4 border-gray-700">
                <h3 class="font-bold text-2xl mb-4 text-gray-800">Reset Website Data</h3>
                <p class="text-sm text-gray-600 mb-4">This will clear the entire database and re-populate it with the original default products and banners. This action cannot be undone.</p>
                <button id="resetDataButton" class="w-full md:w-auto bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-md">Reset to Defaults</button>
            </div>

        </div>
    </div>
    
    <!-- Modals -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center">
            <i class="fas fa-check-circle text-5xl text-green-500 mb-4"></i>
            <h2 class="text-2xl font-bold mb-2">Message Sent!</h2>
            <p>Thank you for reaching out. We'll get back to you soon.</p>
            <button id="closeSuccessModal" class="mt-6 bg-amber-700 hover:bg-amber-800 text-white font-bold py-2 px-6 rounded-md">OK</button>
        </div>
    </div>

    <div id="resetConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center w-full max-w-md">
            <i class="fas fa-exclamation-triangle text-5xl text-red-500 mb-4"></i>
            <h2 class="text-2xl font-bold mb-2">Are you sure?</h2>
            <p class="text-gray-600">This will permanently delete all collections from the database and restore the original content.</p>
            <div class="mt-6 flex justify-center gap-4">
                 <button id="cancelReset" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-md">Cancel</button>
                <button id="confirmReset" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-md">Yes, Reset Data</button>
            </div>
        </div>
    </div>
    
    <!-- Delete Message Confirmation Modal -->
    <div id="deleteMessageConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center w-full max-w-md">
            <i class="fas fa-exclamation-triangle text-5xl text-yellow-500 mb-4"></i>
            <h2 class="text-2xl font-bold mb-2">Delete Message?</h2>
            <p class="text-gray-600">Are you sure you want to permanently delete this message?</p>
            <div class="mt-6 flex justify-center gap-4">
                 <button id="cancelDeleteMessage" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-md">Cancel</button>
                <button id="confirmDeleteMessage" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-md">Yes, Delete</button>
            </div>
        </div>
    </div>


    <!-- Edit Product Modal -->
    <div id="editProductModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-6 text-center">Edit Product</h2>
            <form id="editProductForm">
                <input type="hidden" id="editProductCollectionName">
                <input type="hidden" id="editProductIndex">
                
                <div class="mb-4">
                    <label for="editProductName" class="block text-sm font-medium text-gray-700">Product Name</label>
                    <input type="text" id="editProductName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required>
                </div>

                <div class="mb-4">
                    <label for="editProductPrice" class="block text-sm font-medium text-gray-700">Price</label>
                    <input type="text" id="editProductPrice" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-amber-500 focus:border-amber-500" required>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700">Product Image</label>
                    <div class="mt-2 flex items-center gap-4">
                        <img id="editProductImagePreview" src="" alt="Current Image" class="w-20 h-20 object-cover rounded-md">
                        <div>
                             <label for="editProductImageFile" class="block text-sm font-medium text-gray-700">Upload New (optional)</label>
                             <input type="file" id="editProductImageFile" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-amber-100 file:text-amber-800 hover:file:bg-amber-200">
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-end gap-4">
                    <button type="button" id="closeEditModal" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-md">Cancel</button>
                    <button type="submit" class="bg-amber-700 hover:bg-amber-800 text-white font-bold py-2 px-4 rounded-md">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Messages Modal -->
    <div id="messagesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-3xl h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 pb-4 border-b">
                <h2 class="text-2xl font-bold">Contact Form Messages</h2>
                <button id="closeMessagesModal" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="messageListContainer" class="flex-grow overflow-y-auto space-y-4 pr-2">
                <!-- Messages will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- START FIREBASE INTEGRATION -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, getDoc, setDoc, updateDoc, deleteDoc, writeBatch, getDocs, addDoc, query, orderBy, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let db, auth;
        let collectionsData = {};
        let heroData = {};
        const collectionGridLoader = document.getElementById('collection-grid-loader');

        // Default data to populate the database if it's empty
        const defaultCollectionsData = { "For Him": { bannerImage: "https://images.unsplash.com/photo-1571395434521-5cc1c14f7759?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzNjE5OHwwfDF8c2VhcmNofDEyfHxnaWZ0JTIwZm9yJTIwbWVufGVufDB8fHx8MTY3ODg5ODg4NA&ixlib=rb-4.0.3&q=80&w=600", products: [ { name: "The Executive", price: "₹2,499", imageUrl: "https://images.unsplash.com/photo-1617192237372-9a72d7336ce0?q=80&w=1887&auto=format&fit=crop" }, { name: "Gourmet Gentleman", price: "₹2,699", imageUrl: "https://images.unsplash.com/photo-1559819423-7a7ce35359df?q=80&w=1887&auto=format&fit=crop" }, { name: "Adventure Kit", price: "₹2,199", imageUrl: "https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?q=80&w=2070&auto=format&fit=crop" }, ] }, "For Her": { bannerImage: "https://images.unsplash.com/photo-1594035934090-09c313de1194?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzNjE5OHwwfDF8c2VhcmNofDV8fHNwYSUyMGdpZnQlMjBzZXR8ZW58MHx8fHwxNjc4ODk4OTI1&ixlibrb-4.0.3&q=80&w=600", products: [ { name: "Spa Day Retreat", price: "₹2,999", imageUrl: "https://images.unsplash.com/photo-1570172619644-dfd03ed5d881?q=80&w=2070&auto=format&fit=crop" }, { name: "The Glamour Box", price: "₹3,499", imageUrl: "https://images.unsplash.com/photo-1596462502278-27bfdc403348?q=80&w=2080&auto=format&fit=crop" }, { name: "Sweet Serenity", price: "₹2,799", imageUrl: "https://images.unsplash.com/photo-1620052298288-c4a45a3a25b8?q=80&w=1887&auto=format&fit=crop" }, ] }, "For Kids": { bannerImage: "https://images.unsplash.com/photo-1566576912317-15635208114f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzNjE5OHwwfDF8c2VhcmNofDEwfHxraWRzJTIwZ2lmdCUyMGJhc2tldHxlbnwwfHx8fDE2Nzg4OTg5NjY&ixlib-rb-4.0.3&q=80&w=600", products: [ { name: "Creative Explorer", price: "₹1,999", imageUrl: "https://images.unsplash.com/photo-1516627145408-4d538a7c206a?q=80&w=2070&auto=format&fit=crop" }, { name: "Candy Kingdom", price: "₹1,499", imageUrl: "https://images.unsplash.com/photo-1600719828790-a52da69866e4?q=80&w=1887&auto=format&fit=crop" }, { name: "Toy Trove", price: "₹2,299", imageUrl: "https://images.unsplash.com/photo-1560859252-e1644e590210?q=80&w=1964&auto=format&fit=crop" }, ] }, "Weddings": { bannerImage: "https://images.unsplash.com/photo-1526301828286-9856f68903a4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzNjE5OHwwfDF8c2VhcmNofDEzfHx3ZWRkaW5nJTIwZ2lmdHxlbnwwfHx8fDE2Nzg4OTkwMDQ&ixlib.rb-4.0.3&q=80&w=600", products: [ { name: "To The Happy Couple", price: "₹4,999", imageUrl: "https://images.unsplash.com/photo-1607994695034-7a7615039281?q=80&w=1887&auto=format&fit=crop" }, { name: "Celebration Basket", price: "₹5,999", imageUrl: "https://images.unsplash.com/photo-1594951445585-80f073b22b51?q=80&w=1887&auto=format&fit=crop" }, { name: "Mr. & Mrs. Essentials", price: "₹4,499", imageUrl: "https://images.unsplash.com/photo-1556911073-52527ac402b6?q=80&w=2070&auto=format&fit=crop" }, ] }, "Engagements": { bannerImage: "https://images.unsplash.com/photo-1612178532859-2c9c7b9a5c8c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzNjE5OHwwfDF8c2VhcmNofDR8fHJvbWFudGljJTIwZ2lmdHxlbnwwfHx8fDE2Nzg4OTkwMzg&ixlib-rb-4.0.3&q=80&w=600", products: [ { name: "The Proposal", price: "₹3,999", imageUrl: "https://images.unsplash.com/photo-1598214886343-059032734608?q=80&w=1935&auto=format&fit=crop" }, { name: "Future Mrs.", price: "₹3,499", imageUrl: "https://images.unsplash.com/photo-1620789218698-b6a67a07a53e?q=80&w=1887&auto=format&fit=crop" }, { name: "Love Story Starter", price: "₹3,199", imageUrl: "https://images.unsplash.com/photo-1531701553543-a3d8a77a3433?q=80&w=1887&auto=format&fit=crop" }, ] }, "All Occasions": { bannerImage: "https://images.unsplash.com/photo-1566081024363-3882a836ca4b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzNjE5OHwwfDF8c2VhcmNofDEwfHxnaWZ0JTIwaGFtcGVyfGVufDB8fHx8MTY3ODg5OTA2NQ&ixlib.rb-4.0.3&q=80&w=600", products: [ { name: "Classic Celebration", price: "₹2,199", imageUrl: "https://images.unsplash.com/photo-1602491595018-b0a23dc86968?q=80&w=1887&auto=format&fit=crop" }, { name: "Thank You Kindly", price: "₹1,899", imageUrl: "https://images.unsplash.com/photo-1593101982592-54c38221655e?q=80&w=1887&auto=format&fit=crop" }, { name: "Birthday Surprise", price: "₹2,499", imageUrl: "https://images.unsplash.com/photo-1576836165620-a8328f526017?q=80&w=1964&auto=format&fit=crop" }, ] }, "Candles": { bannerImage: "https://images.unsplash.com/photo-1594212699903-ec8a64e1f9ee?q=80&w=1887&auto=format&fit=crop", products: [ { name: "Serene Lavender", price: "₹1,299", imageUrl: "https://images.unsplash.com/photo-1600857544256-6254420655ec?q=80&w=1887&auto=format&fit=crop" }, { name: "Vanilla Bean Dream", price: "₹1,199", imageUrl: "https://images.unsplash.com/photo-1614294237583-1459a688d0b2?q=80&w=1887&auto=format&fit=crop" }, { name: "Sandalwood Musk", price: "₹1,499", imageUrl: "https://images.unsplash.com/photo-1617805232938-00278f24025d?q=80&w=1887&auto=format&fit=crop" }, ] } };
        const defaultHeroData = {
            title: "Gifting, Reimagined.",
            subtitle: "Discover beautifully curated hampers that tell a story and create lasting memories.",
            buttonText: "Explore Our Collections",
            backgroundImageUrl: "https://images.unsplash.com/photo-1604164372215-2a2245224716?q=80&w=2070&auto=format&fit=crop"
        };
        
        async function initializeDefaultData() {
            console.log("Initializing database with default data...");
            const batch = writeBatch(db);
            for (const collectionName in defaultCollectionsData) {
                batch.set(doc(db, 'collections', collectionName), defaultCollectionsData[collectionName]);
            }
            batch.set(doc(db, "siteContent", "hero"), defaultHeroData);
            try {
                await batch.commit();
                console.log("Default data has been written to the database.");
            } catch (error) {
                console.error("Error writing default data:", error);
            }
        }

        async function main() {
            try {
                let firebaseConfig;

                if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                    firebaseConfig = JSON.parse(__firebase_config);
                } else {
                    console.warn("Using fallback Firebase configuration.");
                    firebaseConfig = {
                        apiKey: "AIzaSyCHB-tBbDR-r1k_yOMt_p3b_p3-b_Z-tDc",
                        authDomain: "ml-hampers-website.firebaseapp.com",
                        projectId: "ml-hampers-website",
                        storageBucket: "ml-hampers-website.appspot.com",
                        messagingSenderId: "955835509550",
                        appId: "1:955835509550:web:1234abcd5678efgh1234ij"
                    };
                }
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('Debug'); 

                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                console.log("Firebase Authenticated:", auth.currentUser ? auth.currentUser.uid : 'Anonymous');
                
                initializeAppLogic();

            } catch (e) {
                console.error("Firebase initialization failed:", e);
                collectionGridLoader.innerHTML = `<p class="text-red-500 text-center">Error: Could not connect to the database. Please check configuration.</p>`;
            }
        }

        function initializeAppLogic() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

            const contactForm = document.getElementById('contactForm');
            const successModal = document.getElementById('successModal');
            const closeSuccessModal = document.getElementById('closeSuccessModal');
            
            contactForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const button = e.submitter;
                button.disabled = true;
                button.textContent = "Sending...";

                const name = contactForm.querySelector('input[placeholder="Your Name"]').value;
                const email = contactForm.querySelector('input[placeholder="Your Email"]').value;
                const message = contactForm.querySelector('textarea').value;
                
                try {
                    await addDoc(collection(db, "messages"), { name, email, message, timestamp: new Date() });
                    successModal.classList.remove('hidden');
                    contactForm.reset();
                } catch (error) {
                    console.error("Error saving message: ", error);
                } finally {
                    button.disabled = false;
                    button.textContent = "Send Message";
                }
            });

            closeSuccessModal.addEventListener('click', () => successModal.classList.add('hidden'));

            const collectionsContainer = document.getElementById('collections-container');
            const productsContainer = document.getElementById('products-container');
            const collectionGrid = document.getElementById('collection-grid');
            const productGrid = document.getElementById('product-grid');
            const backToCollectionsBtn = document.getElementById('back-to-collections');
            const productCollectionTitle = document.getElementById('product-collection-title');

            function renderCollectionBanners() {
                if (Object.keys(collectionsData).length === 0) {
                    collectionGridLoader.classList.remove('hidden');
                    collectionGrid.classList.add('hidden');
                    return;
                }
                collectionGridLoader.classList.add('hidden');
                collectionGrid.classList.remove('hidden');
                collectionGrid.innerHTML = '';
                const sortedCollectionNames = Object.keys(collectionsData).sort();
                for (const collectionName of sortedCollectionNames) {
                    const collection = collectionsData[collectionName];
                    const bannerCard = `
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden card-hover-effect cursor-pointer" data-collection="${collectionName}">
                            <div class="relative">
                                <img src="${collection.bannerImage}" alt="${collectionName}" class="w-full h-80 object-cover">
                                <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
                                    <h3 class="text-3xl font-playfair font-bold text-white text-center">${collectionName}</h3>
                                </div>
                            </div>
                        </div>`;
                    collectionGrid.innerHTML += bannerCard;
                }
                document.querySelectorAll('#collection-grid .card-hover-effect').forEach(card => {
                    card.addEventListener('click', () => {
                        const collectionName = card.dataset.collection;
                        renderProductsForCollection(collectionName);
                        collectionsContainer.classList.add('hidden');
                        productsContainer.classList.remove('hidden');
                        window.scrollTo({ top: productsContainer.offsetTop - 100, behavior: 'smooth' });
                    });
                });
            }

            function renderProductsForCollection(collectionName) {
                productCollectionTitle.textContent = collectionName;
                productGrid.innerHTML = '';
                const collection = collectionsData[collectionName];
                const products = collection ? collection.products : [];

                if (!products || products.length === 0) {
                    productGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">No products in this collection yet.</p>`;
                    return;
                }
                products.forEach(product => {
                    const whatsappNumber = '918948581236';
                    const message = encodeURIComponent(`Hello M&L Hampers, I'm interested in the "${product.name}" hamper from the ${collectionName} collection.`);
                    const whatsappLink = `https://wa.me/${whatsappNumber}?text=${message}`;
                    const productCard = `
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden card-hover-effect flex flex-col">
                            <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-64 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/a87c5b/ffffff?text=Image+Not+Found';">
                            <div class="p-6 flex-grow">
                                <h3 class="text-2xl font-playfair font-bold mb-2">${product.name}</h3>
                                <p class="text-xl font-semibold text-amber-800 mb-4">${product.price}</p>
                            </div>
                             <div class="p-4 bg-gray-50 text-center">
                                <a href="${whatsappLink}" target="_blank" class="inline-flex items-center justify-center bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">
                                    <i class="fab fa-whatsapp mr-2"></i> Inquire Now
                                </a>
                            </div>
                        </div>`;
                    productGrid.innerHTML += productCard;
                });
            }

            backToCollectionsBtn.addEventListener('click', () => {
                productsContainer.classList.add('hidden');
                collectionsContainer.classList.remove('hidden');
            });

            const adminLoginLink = document.getElementById('secretAdminLogin');
            const adminModal = document.getElementById('adminModal');
            const closeModal = document.getElementById('closeModal');
            const adminLoginForm = document.getElementById('adminLoginForm');
            const adminPanel = document.getElementById('adminPanel');
            const logoutButton = document.getElementById('logoutButton');
            const loginError = document.getElementById('login-error');
            
            const createCollectionForm = document.getElementById('createCollectionForm');
            const collectionSuccessMessage = document.getElementById('collection-success-message');
            const collectionErrorMessage = document.getElementById('collection-error-message');
            const collectionErrorText = document.getElementById('collection-error-text');
            const addProductForm = document.getElementById('addProductForm');
            const productSuccessMessage = document.getElementById('product-success-message');
            const updateBannerForm = document.getElementById('updateBannerForm');
            const bannerSuccessMessage = document.getElementById('banner-success-message');
            const removeProductForm = document.getElementById('removeProductForm');
            const removeProductSuccessMessage = document.getElementById('remove-product-success-message');
            const editProductSuccessMessage = document.getElementById('edit-product-success-message');
            const manageHeroForm = document.getElementById('manageHeroForm');
            const heroSuccessMessage = document.getElementById('hero-success-message');

            const productCollectionSelect = document.getElementById('productCollection');
            const bannerCollectionSelect = document.getElementById('bannerCollectionSelect');
            const removeProductCollectionSelect = document.getElementById('removeProductCollectionSelect');
            const productToRemoveSelect = document.getElementById('productToRemoveSelect');
            const manageCollectionSelect = document.getElementById('manageCollectionSelect');
            
            const searchProductToRemoveInput = document.getElementById('searchProductToRemove');
            const searchProductToManageInput = document.getElementById('searchProductToManage');

            const productListContainer = document.getElementById('productListContainer');

            const editProductModal = document.getElementById('editProductModal');
            const editProductForm = document.getElementById('editProductForm');
            const closeEditModal = document.getElementById('closeEditModal');

            const viewMessagesBtn = document.getElementById('viewMessagesBtn');
            const messagesModal = document.getElementById('messagesModal');
            const closeMessagesModal = document.getElementById('closeMessagesModal');
            const messageListContainer = document.getElementById('messageListContainer');

            const resetDataButton = document.getElementById('resetDataButton');
            const resetConfirmModal = document.getElementById('resetConfirmModal');
            const cancelReset = document.getElementById('cancelReset');
            const confirmReset = document.getElementById('confirmReset');

            const deleteMessageConfirmModal = document.getElementById('deleteMessageConfirmModal');
            const cancelDeleteMessage = document.getElementById('cancelDeleteMessage');
            const confirmDeleteMessage = document.getElementById('confirmDeleteMessage');
            let messageIdToDelete = null;

            function populateProductsForManagement(collectionName, searchTerm = '') {
                productListContainer.innerHTML = '';
                const collection = collectionsData[collectionName];
                const products = collection ? collection.products : [];
                if (!products || products.length === 0) {
                    productListContainer.innerHTML = `<p class="text-center text-gray-500 p-4">No products.</p>`;
                    return;
                }
                const lowerCaseSearchTerm = searchTerm.toLowerCase();
                const filteredProducts = products.filter(p => p.name.toLowerCase().includes(lowerCaseSearchTerm));
                if (filteredProducts.length === 0) {
                    productListContainer.innerHTML = `<p class="text-center text-gray-500 p-4">No matching products.</p>`;
                    return;
                }
                filteredProducts.forEach(product => {
                    const productIndex = products.indexOf(product);
                    const productElement = document.createElement('div');
                    productElement.className = 'flex items-center justify-between p-3 bg-white rounded-md shadow-sm';
                    productElement.innerHTML = `
                        <div class="flex items-center gap-3">
                            <img src="${product.imageUrl}" alt="${product.name}" class="w-12 h-12 object-cover rounded">
                            <div>
                                <p class="font-semibold">${product.name}</p>
                                <p class="text-sm text-gray-600">${product.price}</p>
                            </div>
                        </div>
                        <button class="edit-product-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded text-sm" data-collection="${collectionName}" data-index="${productIndex}">Edit</button>
                    `;
                    productListContainer.appendChild(productElement);
                });
            }

            function populateProductsToRemoveSelect(collectionName, searchTerm = '') {
                productToRemoveSelect.innerHTML = '';
                const collection = collectionsData[collectionName];
                const products = collection ? collection.products : [];
                if (!products || products.length === 0) {
                    productToRemoveSelect.innerHTML = `<option disabled>No products in this collection</option>`;
                    return;
                }
                const lowerCaseSearchTerm = searchTerm.toLowerCase();
                const filteredProducts = products
                    .map((p, i) => ({ ...p, originalIndex: i }))
                    .filter(p => p.name.toLowerCase().includes(lowerCaseSearchTerm));
                if (filteredProducts.length === 0) {
                    productToRemoveSelect.innerHTML = `<option disabled>No matching products found</option>`;
                    return;
                }
                filteredProducts.forEach(p => {
                    productToRemoveSelect.innerHTML += `<option value="${p.originalIndex}">${p.name}</option>`;
                });
            }
            
            function populateCollectionSelects() {
                const selects = [productCollectionSelect, bannerCollectionSelect, removeProductCollectionSelect, manageCollectionSelect];
                selects.forEach(s => s.innerHTML = '');
                const sortedCollectionNames = Object.keys(collectionsData).sort();
                for (const collectionName of sortedCollectionNames) {
                    selects.forEach(s => s.innerHTML += `<option value="${collectionName}">${collectionName}</option>`);
                }
            }
            
            function populateHeroAdminForm() {
                document.getElementById('heroTitleInput').value = heroData.title || '';
                document.getElementById('heroSubtitleInput').value = heroData.subtitle || '';
                document.getElementById('heroButtonInput').value = heroData.buttonText || '';
                document.getElementById('heroImagePreview').src = heroData.backgroundImageUrl || '';
            }

            adminLoginLink.addEventListener('click', e => { e.preventDefault(); adminModal.classList.remove('hidden'); });
            closeModal.addEventListener('click', () => { adminModal.classList.add('hidden'); loginError.classList.add('hidden'); adminLoginForm.reset(); });
            adminModal.addEventListener('click', e => { if (e.target === adminModal) closeModal.click(); });

            adminLoginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                if (username === '95583550' && password === 'Misbah&hamper#ML') {
                    adminModal.classList.add('hidden');
                    adminPanel.classList.remove('hidden');
                    adminLoginForm.reset();
                    loginError.classList.add('hidden');
                    populateCollectionSelects();
                    populateHeroAdminForm();
                    const firstCollection = Object.keys(collectionsData)[0];
                    if(firstCollection) {
                        populateProductsToRemoveSelect(firstCollection);
                        populateProductsForManagement(firstCollection);
                    }
                } else {
                    loginError.textContent = 'Invalid username or password.';
                    loginError.classList.remove('hidden');
                }
            });

            manageHeroForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const button = e.submitter;
                button.disabled = true; button.textContent = 'Saving...';

                const newTitle = document.getElementById('heroTitleInput').value;
                const newSubtitle = document.getElementById('heroSubtitleInput').value;
                const newButtonText = document.getElementById('heroButtonInput').value;
                const newImageFile = document.getElementById('heroImageInput').files[0];

                let dataToUpdate = {
                    title: newTitle,
                    subtitle: newSubtitle,
                    buttonText: newButtonText
                };
                
                const saveToDb = async () => {
                    try {
                        await setDoc(doc(db, "siteContent", "hero"), dataToUpdate, { merge: true });
                        heroSuccessMessage.classList.remove('hidden');
                        setTimeout(() => heroSuccessMessage.classList.add('hidden'), 4000);
                    } catch (error) {
                        console.error("Error saving hero content:", error);
                    } finally {
                        button.disabled = false; button.textContent = 'Save Hero Changes';
                    }
                };

                if (newImageFile) {
                    const reader = new FileReader();
                    reader.onload = async (event) => {
                        dataToUpdate.backgroundImageUrl = event.target.result;
                        await saveToDb();
                    };
                    reader.readAsDataURL(newImageFile);
                } else {
                    await saveToDb();
                }
            });

            createCollectionForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const button = e.submitter;
                button.disabled = true; button.textContent = 'Creating...';
                const collectionName = document.getElementById('newCollectionName').value.trim();
                const bannerFile = document.getElementById('newCollectionBannerImage').files[0];

                if (!collectionName || !bannerFile) {
                    collectionErrorText.textContent = "Please provide a name and a banner image.";
                    collectionErrorMessage.classList.remove('hidden');
                    setTimeout(() => collectionErrorMessage.classList.add('hidden'), 4000);
                    button.disabled = false; button.textContent = 'Create Collection';
                    return;
                }
                if (collectionsData[collectionName]) {
                    collectionErrorText.textContent = "A collection with this name already exists.";
                    collectionErrorMessage.classList.remove('hidden');
                    setTimeout(() => collectionErrorMessage.classList.add('hidden'), 4000);
                    button.disabled = false; button.textContent = 'Create Collection';
                    return;
                }
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const newCollection = { bannerImage: event.target.result, products: [] };
                    try {
                        await setDoc(doc(db, 'collections', collectionName), newCollection);
                        createCollectionForm.reset();
                        collectionSuccessMessage.classList.remove('hidden');
                        setTimeout(() => collectionSuccessMessage.classList.add('hidden'), 4000);
                    } catch (error) {
                        console.error("Error creating collection:", error);
                        collectionErrorText.textContent = "Failed to create collection.";
                        collectionErrorMessage.classList.remove('hidden');
                        setTimeout(() => collectionErrorMessage.classList.add('hidden'), 4000);
                    } finally {
                        button.disabled = false; button.textContent = 'Create Collection';
                    }
                };
                reader.readAsDataURL(bannerFile);
            });
            
            addProductForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const button = e.submitter;
                button.disabled = true; button.textContent = 'Adding...';
                const collectionName = productCollectionSelect.value;
                const productName = document.getElementById('productName').value;
                const productPrice = document.getElementById('productPrice').value;
                const productImageFile = document.getElementById('productImage').files[0];
                if (collectionName && productName && productPrice && productImageFile) {
                    const reader = new FileReader();
                    reader.onload = async function(event) {
                        const newProduct = { name: productName, price: productPrice, imageUrl: event.target.result };
                        const currentProducts = collectionsData[collectionName]?.products || [];
                        const updatedProducts = [...currentProducts, newProduct];
                        try {
                            await updateDoc(doc(db, 'collections', collectionName), { products: updatedProducts });
                            addProductForm.reset();
                            productSuccessMessage.classList.remove('hidden');
                            setTimeout(() => productSuccessMessage.classList.add('hidden'), 4000);
                        } catch (error) {
                            console.error("Error adding product: ", error);
                        } finally {
                            button.disabled = false; button.textContent = 'Add Product';
                        }
                    };
                    reader.readAsDataURL(productImageFile);
                } else {
                     button.disabled = false; button.textContent = 'Add Product';
                }
            });
            
            updateBannerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const button = e.submitter;
                button.disabled = true; button.textContent = 'Updating...';
                const collectionName = bannerCollectionSelect.value;
                const bannerImageFile = document.getElementById('collectionBannerImage').files[0];
                if (collectionName && bannerImageFile) {
                    const reader = new FileReader();
                    reader.onload = async function(event) {
                        try {
                            await updateDoc(doc(db, 'collections', collectionName), { bannerImage: event.target.result });
                            updateBannerForm.reset();
                            bannerSuccessMessage.classList.remove('hidden');
                            setTimeout(() => bannerSuccessMessage.classList.add('hidden'), 4000);
                        } catch (error) {
                            console.error("Error updating banner: ", error);
                        } finally {
                             button.disabled = false; button.textContent = 'Update Banner';
                        }
                    };
                    reader.readAsDataURL(bannerImageFile);
                } else {
                    button.disabled = false; button.textContent = 'Update Banner';
                }
            });

            removeProductCollectionSelect.addEventListener('change', (e) => {
                searchProductToRemoveInput.value = '';
                populateProductsToRemoveSelect(e.target.value);
            });
            searchProductToRemoveInput.addEventListener('input', () => {
                populateProductsToRemoveSelect(removeProductCollectionSelect.value, searchProductToRemoveInput.value);
            });
            removeProductForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const button = e.submitter;
                const collectionName = removeProductCollectionSelect.value;
                const productIndexToRemove = parseInt(productToRemoveSelect.value);
                if (collectionName && !isNaN(productIndexToRemove)) {
                    button.disabled = true; button.textContent = 'Removing...';
                    const currentProducts = collectionsData[collectionName]?.products || [];
                    const updatedProducts = currentProducts.filter((_, index) => index !== productIndexToRemove);
                    try {
                        await updateDoc(doc(db, 'collections', collectionName), { products: updatedProducts });
                        searchProductToRemoveInput.value = '';
                        removeProductSuccessMessage.classList.remove('hidden');
                        setTimeout(() => removeProductSuccessMessage.classList.add('hidden'), 4000);
                    } catch (error) {
                        console.error("Error removing product: ", error);
                    } finally {
                        button.disabled = false; button.textContent = 'Remove Product';
                    }
                }
            });
            
            manageCollectionSelect.addEventListener('change', (e) => {
                searchProductToManageInput.value = '';
                populateProductsForManagement(e.target.value);
            });
            searchProductToManageInput.addEventListener('input', (e) => {
                populateProductsForManagement(manageCollectionSelect.value, e.target.value);
            });
            productListContainer.addEventListener('click', (e) => {
                const editButton = e.target.closest('.edit-product-btn');
                if (editButton) {
                    const collectionName = editButton.dataset.collection;
                    const productIndex = parseInt(editButton.dataset.index);
                    const product = collectionsData[collectionName].products[productIndex];
                    document.getElementById('editProductCollectionName').value = collectionName;
                    document.getElementById('editProductIndex').value = productIndex;
                    document.getElementById('editProductName').value = product.name;
                    document.getElementById('editProductPrice').value = product.price;
                    document.getElementById('editProductImagePreview').src = product.imageUrl;
                    document.getElementById('editProductImageFile').value = '';
                    editProductModal.classList.remove('hidden');
                }
            });
            closeEditModal.addEventListener('click', () => editProductModal.classList.add('hidden'));
            editProductForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const button = e.submitter;
                button.disabled = true; button.textContent = "Saving...";
                const collectionName = document.getElementById('editProductCollectionName').value;
                const productIndex = parseInt(document.getElementById('editProductIndex').value);
                const newName = document.getElementById('editProductName').value;
                const newPrice = document.getElementById('editProductPrice').value;
                const newImageFile = document.getElementById('editProductImageFile').files[0];
                const productsCopy = [...collectionsData[collectionName].products];
                const productToUpdate = { ...productsCopy[productIndex], name: newName, price: newPrice };

                const updateFirestore = async (updatedProduct) => {
                    productsCopy[productIndex] = updatedProduct;
                    try {
                        await updateDoc(doc(db, 'collections', collectionName), { products: productsCopy });
                        editProductSuccessMessage.classList.remove('hidden');
                        setTimeout(() => editProductSuccessMessage.classList.add('hidden'), 4000);
                        editProductModal.classList.add('hidden');
                    } catch(error) {
                        console.error("Error updating product:", error);
                    } finally {
                        button.disabled = false; button.textContent = "Save Changes";
                    }
                };
                if (newImageFile) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        productToUpdate.imageUrl = event.target.result;
                        updateFirestore(productToUpdate);
                    };
                    reader.readAsDataURL(newImageFile);
                } else {
                    updateFirestore(productToUpdate);
                }
            });

            viewMessagesBtn.addEventListener('click', () => messagesModal.classList.remove('hidden'));
            closeMessagesModal.addEventListener('click', () => messagesModal.classList.add('hidden'));
            
            messageListContainer.addEventListener('click', async (e) => {
                const deleteButton = e.target.closest('.delete-message-btn');
                if(deleteButton) {
                    messageIdToDelete = deleteButton.dataset.id;
                    deleteMessageConfirmModal.classList.remove('hidden');
                }
            });
            cancelDeleteMessage.addEventListener('click', () => {
                messageIdToDelete = null;
                deleteMessageConfirmModal.classList.add('hidden');
            });
            confirmDeleteMessage.addEventListener('click', async () => {
                 if (messageIdToDelete) {
                    try {
                        await deleteDoc(doc(db, "messages", messageIdToDelete));
                    } catch (error) {
                        console.error("Error deleting message:", error);
                    } finally {
                        messageIdToDelete = null;
                        deleteMessageConfirmModal.classList.add('hidden');
                    }
                }
            });


            resetDataButton.addEventListener('click', () => resetConfirmModal.classList.remove('hidden'));
            cancelReset.addEventListener('click', () => resetConfirmModal.classList.add('hidden'));
            confirmReset.addEventListener('click', async () => {
                const button = confirmReset;
                button.disabled = true; button.textContent = 'Resetting...';
                try {
                    const collectionsSnap = await getDocs(collection(db, 'collections'));
                    const messagesSnap = await getDocs(collection(db, 'messages'));
                    const deleteBatch = writeBatch(db);
                    collectionsSnap.forEach(doc => deleteBatch.delete(doc.ref));
                    messagesSnap.forEach(doc => deleteBatch.delete(doc.ref));
                    deleteBatch.delete(doc(db, "siteContent", "hero"));
                    await deleteBatch.commit();
                    await initializeDefaultData();
                } catch(error) {
                    console.error("Error resetting data: ", error);
                } finally {
                    resetConfirmModal.classList.add('hidden');
                    button.disabled = false; button.textContent = 'Yes, Reset Data';
                }
            });

            logoutButton.addEventListener('click', () => adminPanel.classList.add('hidden'));
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                     if (!mobileMenu.classList.contains('hidden')) mobileMenu.classList.add('hidden');
                });
            });

            // --- Real-time Firestore Listeners ---
            onSnapshot(collection(db, 'collections'), async (snapshot) => {
                if (snapshot.empty) {
                    await initializeDefaultData(); return; 
                }
                const newCollectionsData = {};
                snapshot.forEach((doc) => newCollectionsData[doc.id] = doc.data());
                collectionsData = newCollectionsData;
                renderCollectionBanners();
                if (!adminPanel.classList.contains('hidden')) {
                    const vals = {
                        removeCol: removeProductCollectionSelect.value,
                        removeSearch: searchProductToRemoveInput.value,
                        manageCol: manageCollectionSelect.value,
                        manageSearch: searchProductToManageInput.value,
                    };
                    populateCollectionSelects();
                    if(vals.removeCol) {
                        removeProductCollectionSelect.value = vals.removeCol;
                        populateProductsToRemoveSelect(vals.removeCol, vals.removeSearch);
                    }
                    if(vals.manageCol) {
                        manageCollectionSelect.value = vals.manageCol;
                        populateProductsForManagement(vals.manageCol, vals.manageSearch);
                    }
                }
            });
            onSnapshot(doc(db, "siteContent", "hero"), async (docSnap) => {
                if (!docSnap.exists()) {
                     await initializeDefaultData(); return;
                }
                heroData = docSnap.data();
                document.getElementById('hero-title').textContent = heroData.title;
                document.getElementById('hero-subtitle').textContent = heroData.subtitle;
                document.getElementById('hero-button').textContent = heroData.buttonText;
                document.getElementById('home').style.backgroundImage = `linear-gradient(to top, rgba(0,0,0,0.6), rgba(0,0,0,0.1)), url('${heroData.backgroundImageUrl}')`;
                if (!adminPanel.classList.contains('hidden')) {
                    populateHeroAdminForm();
                }
            });
            onSnapshot(query(collection(db, "messages"), orderBy("timestamp", "desc")), (snapshot) => {
                messageListContainer.innerHTML = '';
                if (snapshot.empty) {
                    messageListContainer.innerHTML = `<p class="text-center text-gray-500 p-4">No messages yet.</p>`;
                    return;
                }
                snapshot.forEach(doc => {
                    const message = doc.data();
                    const date = message.timestamp.toDate().toLocaleString();
                    const messageEl = document.createElement('div');
                    messageEl.className = 'p-4 bg-gray-50 rounded-lg border';
                    messageEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-bold">${message.name} <span class="font-normal text-gray-600">&lt;${message.email}&gt;</span></p>
                                <p class="text-sm text-gray-500">${date}</p>
                            </div>
                            <button class="delete-message-btn text-red-500 hover:text-red-700" data-id="${doc.id}"><i class="fas fa-trash"></i></button>
                        </div>
                        <p class="mt-2 text-gray-700">${message.message}</p>`;
                    messageListContainer.appendChild(messageEl);
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', main);
    </script>
</body>
</html>


